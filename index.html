<!DOCTYPE html>
<html>
    <head>
        <title>Career Compass</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta charset="UTF-8">
        <link rel="icon"  href="images/miniCCLogo.png">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="navbar.css">
        <script src="https://kit.fontawesome.com/c453ab086d.js" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    </head>
    <body>
        <header id="header">
            <div id="navbarRoot">
                <nav id="navbar">
                    <div id="LogoNav">
                        <a href="winter_penguin_page.html" rel="noopener noreferrer">
                            <img id="logo" src="images/careerCompassLogo.png" alt="careerCompassLogo">
                        </a>
                    </div>


                    <div id="userDiv">
                        <img id="userLogo" src="images/bwProfile.png">
                    </div>

                    </div>


                </nav>
            </div>
        </header>

        <div id="root"></div>

        <main id="mainContent">
            <div id="uploadResume">
                <p id="uploadHeader">Upload Resume</p>
                <p id="uploadSubheader">Upload you resume to recieve tailored advice!</p>
                <div id="dropBox">
                    <img id="fileIcon" src="images/uploadFileIcon.png">
                    <p id="dropBoxp1">Drop your pdf here</p>
                    <p id="dropBoxp2">or click to upload from your device</p>
                    <input type="file" id="resumeInput" accept="application/pdf" hidden>
                    <p id="fileName"></p>
                </div>
            </div>
        </main>

        <script>
            function scrollSlider(direction) 
            {
                const slider = document.getElementById('imageSlider');
                const scrollAmount = 320; // adjust based on image width + gap
                slider.scrollBy
                ({
                    left: direction * scrollAmount,
                    behavior: 'smooth'
                });
            }
        </script>

        <script type="text/babel" src="react.js"></script>
        <script type="text/babel" src="app.js"></script>

        <script>
            document.getElementById('fileIcon').ondragstart = function() { return false; };
        </script>

        <script>
            const dropBox = document.getElementById("dropBox");
            const fileInput = document.getElementById("resumeInput");
            const fileNameDisplay = document.getElementById("fileName");

            // Click to open file dialog
            dropBox.addEventListener("click", () => fileInput.click());

            // File selected
            fileInput.addEventListener("change", (e) => {
                const file = e.target.files[0];
                if (file) handleFileUpload(file);
            });

            // Drag and drop
            dropBox.addEventListener("dragover", (e) => {
                e.preventDefault();
                dropBox.style.backgroundColor = "rgba(200, 230, 255, 0.5)";
            });

            dropBox.addEventListener("dragleave", () => {
                dropBox.style.backgroundColor = "transparent";
            });

            dropBox.addEventListener("drop", (e) => {
                e.preventDefault();
                dropBox.style.backgroundColor = "transparent";
                const file = e.dataTransfer.files[0];
                if (file) handleFileUpload(file);
            });

            async function handleFileUpload(file) {
                if (file.type !== "application/pdf") {
                    alert("Please upload a PDF file only.");
                    return;
                }

                fileNameDisplay.textContent = `Uploading ${file.name}...`;

                // Create FormData
                const formData = new FormData();
                formData.append('resume', file);

                try {
                    // Send to Flask backend
                    const response = await fetch('http://127.0.0.1:5001/upload', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        fileNameDisplay.textContent = `${file.name} uploaded successfully!`;
                        
                        // Wait 1 second then redirect to chatbot
                        setTimeout(() => {
                            window.location.href = "chatbot.html";
                        }, 1000);
                    } else {
                        throw new Error(result.error || "Upload failed");
                    }
                    
                } catch (error) {
                    console.error("Upload failed:", error);
                    fileNameDisplay.textContent = "Upload failed!";
                    alert(`Error: ${error.message}\n\nMake sure Flask server is running:\npython app.py`);
                }
            }

            // Prevent image dragging
            document.getElementById('fileIcon').ondragstart = function() { return false; };
        </script>



    </body>
</html>